<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ver Perfil</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- Menu -->
  <nav class="menu">
    <a href="2-home.html">Página Inicial</a>
    <a href="3-amigos.html">Amigos</a>
    <a href="4-diarios.html">Meus Diários</a>
    <a href="5-perfil.html">Perfil</a>
    <a href="1-index.html" onclick="logout()">Sair</a>
  </nav>

  <!-- Conteúdo -->
  <main>
    <h1 id="nome-usuario"></h1>
    <p><strong>Usuário:</strong> <span id="username"></span></p>
    <img id="foto-preview" src="https://via.placeholder.com/150" style="max-width:150px;border-radius:50%;" alt="Foto de perfil">
    <p align = "center" id="bio"></p>

    <h2>Diários desse usuário</h2>
    <div id="lista-diarios"></div>
  </main>

  <!-- Firebase + JS -->
  <script type="module" src="firebase-init.js"></script>
  <script type="module" src="script.js"></script>

  <script type="module">
    import { ref, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const params = new URLSearchParams(window.location.search);
    const usuario = params.get("user");

    async function carregarPerfilExterno() {
      if (!usuario) return;

      const snap = await get(ref(window.db, "usuarios/" + usuario));
      if (!snap.exists()) {
        document.querySelector("main").innerHTML = "<p>Usuário não encontrado.</p>";
        return;
      }

      const dados = snap.val();

      document.getElementById("nome-usuario").textContent = dados.nome || usuario;
      document.getElementById("username").textContent = usuario;
      document.getElementById("bio").textContent = dados.bio || "";
      document.getElementById("foto-preview").src = dados.foto || "https://via.placeholder.com/150";

      // aplica cor de tema do perfil visitado
      aplicarCorTema(usuario);

      // carrega diários
      const diariosDiv = document.getElementById("lista-diarios");
      diariosDiv.innerHTML = "";
      const diarios = dados.diarios || {};

      Object.keys(diarios).forEach(key => {
        const d = diarios[key];
        let div = document.createElement("div");
        div.classList.add("card");
        div.innerHTML = `
          <h3>${d.titulo}</h3>
          <small>${d.data}</small>
          <p>${d.texto}</p>
          ${d.foto ? `<img src="${d.foto}" style="max-width:200px;">` : ""}
        `;
        diariosDiv.appendChild(div);
      });
    }

    window.onload = carregarPerfilExterno;
  </script>
</body>
</html>
